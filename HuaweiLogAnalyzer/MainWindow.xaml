<Window x:Class="UniversalLogAnalyzer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d"
        Title="Universal Log Analyzer - Network Forensics Tool" Height="700" Width="1200"
        ResizeMode="CanResizeWithGrip"
        WindowStartupLocation="CenterScreen"
        AllowDrop="True"
        Drop="Window_Drop"
        DragOver="Window_DragOver">

    <DockPanel>
        <Menu DockPanel.Dock="Top">
            <MenuItem Header="File">
                <MenuItem Header="Open" Click="OpenFile_Click"/>
                <MenuItem Header="Exit" Click="Exit_Click"/>
            </MenuItem>
            <MenuItem Header="Help">
                <MenuItem Header="About" Click="About_Click"/>
            </MenuItem>
        </Menu>

        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TabControl x:Name="MainTabs" Grid.Row="0" Margin="16">
                <TabItem Header="Analysis Results">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="400"/>
                            <ColumnDefinition Width="5"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <TreeView x:Name="ResultsTree" Grid.Column="0">
                            <!-- Remove auto-expansion -->
                        </TreeView>

                        <GridSplitter Grid.Column="1" Width="5" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>

                        <Border Grid.Column="2" BorderThickness="2" BorderBrush="Gray" CornerRadius="4"
                                AllowDrop="True" Drop="Window_Drop" DragOver="Window_DragOver">
                            <Grid Background="LightGray">
                                <TextBlock x:Name="DropZoneText"
                                         Text="Drop Huawei log files here to analyze"
                                         HorizontalAlignment="Center"
                                         VerticalAlignment="Center"
                                         FontSize="18"
                                         Foreground="Black"
                                         FontWeight="Medium"/>
                            </Grid>
                        </Border>
                    </Grid>
                </TabItem>

                <TabItem Header="Performance Metrics">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Text="Performance Metrics" FontSize="18" FontWeight="Bold" Margin="16,16,16,0"/>
                        <ListView x:Name="PerformanceList" Grid.Row="1" Margin="16">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Device" DisplayMemberBinding="{Binding Device}" Width="150"/>
                                    <GridViewColumn Header="Metric" DisplayMemberBinding="{Binding Metric}" Width="200"/>
                                    <GridViewColumn Header="Value" DisplayMemberBinding="{Binding Value}" Width="100"/>
                                    <GridViewColumn Header="Unit" DisplayMemberBinding="{Binding Unit}" Width="80"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>

                <TabItem Header="Anomaly Detection">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        <TextBlock Grid.Row="0" Text="Detected Anomalies" FontSize="16" FontWeight="Bold" Margin="10"/>
                        <ListView x:Name="AnomalyList" Grid.Row="1" Margin="10">
                            <ListView.View>
                                <GridView>
                                    <GridViewColumn Header="Type" DisplayMemberBinding="{Binding Type}" Width="150"/>
                                    <GridViewColumn Header="Description" DisplayMemberBinding="{Binding Description}" Width="300"/>
                                    <GridViewColumn Header="Severity" DisplayMemberBinding="{Binding Severity}" Width="100"/>
                                </GridView>
                            </ListView.View>
                        </ListView>
                    </Grid>
                </TabItem>

                    <TabItem Header="Topology Visualization">
                        <Grid>
                            <Canvas x:Name="TopologyCanvas" Background="WhiteSmoke" Margin="8"
                                    ClipToBounds="True"
                                    MouseWheel="TopologyCanvas_MouseWheel"
                                    MouseLeftButtonDown="TopologyCanvas_MouseLeftButtonDown"
                                    MouseLeftButtonUp="TopologyCanvas_MouseLeftButtonUp"
                                    MouseMove="TopologyCanvas_MouseMove" />
                        </Grid>
                    </TabItem>

                <TabItem Header="Log">
                    <TextBox x:Name="LogBox"
                            IsReadOnly="True"
                            TextWrapping="Wrap"
                            VerticalScrollBarVisibility="Auto"
                            HorizontalScrollBarVisibility="Auto"
                            FontFamily="Consolas"
                            Background="White"
                            Foreground="Black"
                            Padding="10"/>
                </TabItem>

                <TabItem Header="Raw Data">
                    <TreeView x:Name="UnparsedTree">
                        <TreeView.Resources>
                            <Style TargetType="{x:Type TreeViewItem}">
                                <!-- Default collapsed to reduce noise -->
                                <Setter Property="IsExpanded" Value="False"/>
                            </Style>
                        </TreeView.Resources>
                    </TreeView>
                </TabItem>
            </TabControl>

            <Border Grid.Row="1" Background="LightGray" BorderBrush="Gray" BorderThickness="0,1,0,0">
                <Grid Margin="16,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <ProgressBar x:Name="ProgressBar" Height="20" Margin="0,0,10,0"/>

                    <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,10,0">
                        <CheckBox x:Name="ExcelCheckBox" Content="Excel Export" IsChecked="True" Margin="0,0,10,0" Checked="ExportFormat_Checked" Unchecked="ExportFormat_Unchecked"/>
                        <CheckBox x:Name="CsvCheckBox" Content="CSV Export" IsChecked="False" Margin="0,0,10,0" Checked="ExportFormat_Checked" Unchecked="ExportFormat_Unchecked"/>
                        <CheckBox x:Name="JsonCheckBox" Content="JSON Export" IsChecked="False" Checked="ExportFormat_Checked" Unchecked="ExportFormat_Unchecked"/>
                        <CheckBox x:Name="ShowEndpointsCheckBox" Content="Show Endpoints" IsChecked="True" Margin="12,0,10,0" Checked="ShowEndpointsCheckBox_Checked" Unchecked="ShowEndpointsCheckBox_Unchecked"/>
                        <CheckBox x:Name="ShowMacsCheckBox" Content="Show MACs" IsChecked="True" Margin="0,0,10,0" Checked="ShowMacsCheckBox_Checked" Unchecked="ShowMacsCheckBox_Unchecked"/>
                        <CheckBox x:Name="CollapseHostsCheckBox" Content="Collapse Hosts" IsChecked="False" Margin="12,0,10,0" Checked="CollapseHostsCheckBox_Checked" Unchecked="CollapseHostsCheckBox_Unchecked"/>
                    </StackPanel>

                    <StackPanel Grid.Column="2" Orientation="Horizontal" VerticalAlignment="Center" HorizontalAlignment="Right" Margin="0,0,10,0">
                        <TextBlock Text="Log Type:" VerticalAlignment="Center" Margin="0,0,6,0"/>
                        <ComboBox x:Name="LogTypeComboBox" Width="180" SelectionChanged="LogTypeComboBox_SelectionChanged"/>
                    </StackPanel>

                    <TextBlock x:Name="StatusText" Grid.Column="3" Text="Idle" VerticalAlignment="Center" MinWidth="200" Margin="0,0,10,0" FontWeight="Medium"/>
                    <Button x:Name="CancelButton" Grid.Column="4" Content="Cancel" Width="80" Height="32"
                            Click="CancelButton_Click" IsEnabled="False"/>
                </Grid>
            </Border>
        </Grid>
    </DockPanel>
</Window>
